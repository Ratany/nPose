// The nPose scripts are licensed under the GPLv2
// (http://www.gnu.org/licenses/gpl-2.0.txt), with the following
// addendum:
//
// The nPose scripts are free to be copied, modified, and
// redistributed, subject to the following conditions:
//
//    - If you distribute the nPose scripts, you must leave them full
//      perms.
//
//    - If you modify the nPose scripts and distribute the
//      modifications, you must also make your modifications full
//      perms.
//
// "Full perms" means having the modify, copy, and transfer
// permissions enabled in Second Life and/or other virtual world
// platforms derived from Second Life (such as OpenSim).  If the
// platform should allow more fine-grained permissions, then "full
// perms" will mean the most permissive possible set of permissions
// allowed by the platform.
// =repo-npose/menu-vic.o
// compiled Tue Jan 28 09:53:15 2014 UTC
list vAA=["Public"];string vAB="off";string vAC="off";string vAD="on";string vAE="off";string vAF="on";string vAG="off";key vAH;list vAI;list vAJ;list vAK=[];string vAL="SET";string vAM="BTN";string vAN="DEFAULT";list vAO=[vAL,vAN,vAM];list vAP=[];list vAQ;integer vAR=-900;integer vAS=-901;integer vAT=-902;integer vAU=200;integer vAV=201;integer vAW=202;integer vAX=204;integer vAY=205;integer vAZ=206;integer vBA=207;integer vBB=208;integer vBC=209;integer vBD=210;integer vBE=-800;integer vBF=-801;integer vBG=34334;integer vBH=-240;string vBI="forward";string vBJ="backward";string vBK="left";string vBL="right";string vBM="up";string vBN="down";string vBO="reset";float vBP=0.2;list vBQ=[vBI,vBK,vBM,vBJ,vBL,vBN,"0.2","0.1","0.05","0.01",vBO];string vBR;string vBS;integer vBT=0;string vBU="ChangeSeat";string vBV="sync";string vBW="offset";string vBX="^";string vBY="Main";string vBZ="admin";string vCA="ManageRLV";string vCB="Adjust";string vCC="StopAdjust";string vCD="PosDump";string vCE="Unsit";string vCF="Options";string vCG="Menuonsit";string vCH="ToDefault";string vCI="Permit";string vCJ="Public";string vCK="Locked";string vCL="Group";list vCM;list vCN=[vCB,vCC,vCD,vCE,vCF];list vCO=[];string vDW;key vCQ(key vCR,string vDH,list vCT,list vCU,integer vEU){key vGC="";if(vAH!=llGetOwner()&&(vAE=="off")){integer vCX=llGetListLength(vCT);integer vCY;for(vCY=0;vCY<vCX;++vCY){integer vCZ=llListFindList(vAK,[llList2String(vCT,vCY)]);if(vCZ!=-1){if(llList2String(vAK,vCZ+1)=="owner"){vCT=llDeleteSubList(vCT,vCY,vCY);vCY--;vCX--;}else if(llList2String(vAK,vCZ+1)!="public"){if(llList2String(vAK,vCZ+1)=="group"){if(llSameGroup(vAH)!=1){vCT=llDeleteSubList(vCT,vCY,vCY);vCY--;vCX--;}}}}}vGC=llHTTPRequest("http://google.com",[HTTP_METHOD,"GET"],"");llMessageLinked(LINK_SET,vAR,(string)vCR+"|"+vDH+"|"+(string)vEU+"|"+llDumpList2String(vCT,"`")+"|"+llDumpList2String(vCU,"`"),vGC);}else if(((vAH==llGetOwner())||(vAE=="off"))||(vAH!=llGetOwner()&&vAE=="on"&&llListFindList(vDA(),[(key)vAH])!=-1)){vGC=llHTTPRequest("http://google.com",[HTTP_METHOD,"GET"],"");llMessageLinked(LINK_SET,vAR,(string)vCR+"|"+vDH+"|"+(string)vEU+"|"+llDumpList2String(vCT,"`")+"|"+llDumpList2String(vCU,"`"),vGC);}return vGC;}list vDA(){vAI=[];integer vDB=llGetNumberOfPrims();while(llGetAgentSize(llGetLinkKey(vDB))!=ZERO_VECTOR){vAI+=[llGetLinkKey(vDB)];vDB--;}return vAI;}integer vDC(){integer vFV=llGetNumberOfPrims();integer vFW=vFV;while(llGetAgentSize(llGetLinkKey(vFW))!=ZERO_VECTOR){vFW--;}return vFV-vFW;}AdminMenu(key vDV,string vDW,string vDH,list vFI){key vGC=vCQ(vDV,vDH+"\n"+vDW+"\n",vFI,[vBX],0);integer vFT=llListFindList(vAQ,[vDV]);list vDU=[vGC,vDV,vDW];if(vFT==-1){vAQ+=vDU;}else{vAQ=llListReplaceList(vAQ,vDU,vFT-1,vFT+1);}}DoMenu(key vDV,string vDW,string vDX,integer vEU){integer vFT=llListFindList(vAJ,[vDW]);if(vFT!=-1){list vFI=llListSort(llParseStringKeepNulls(llList2String(vAJ,vFT+1),["|"],[]),1,1);list vDS=[];if(vDW!=vBY){vDS+=[vBX];}key vGC=vCQ(vDV,vDX+"\n"+vDW+"\n",vFI,vDS,vEU);list vDU=[vGC,vDV,vDW];vFT=llListFindList(vAQ,[vDV]);if(vFT==-1){vAQ+=vDU;}else{vAQ=llListReplaceList(vAQ,vDU,vFT-1,vFT+1);}}}DoMenu_AccessCtrl(key vDV,string vDW,string vDX,integer vEU){integer vDZ=FALSE;if(vDV==llGetOwner()){if((llListFindList(vCM,[(string)llGetOwner()])!=-1&&vAG=="on")||llListFindList(vCM,[(string)llGetOwner()])==-1){vDZ=TRUE;}}else if(((llList2String(vAA,0)==vCL)&&(llSameGroup(vDV)))||(llList2String(vAA,0)==vCJ)){if(llListFindList(vCM,[(string)vDV])==-1&&vAG=="on"){vDZ=TRUE;}}if(vDZ){DoMenu(vDV,vDW,vDX,vEU);}}BuildMenus(){vAJ=[];vAK=[];integer vFV=llGetInventoryNumber(INVENTORY_NOTECARD);integer vEB=FALSE;integer vFW;for(vFW=0;vFW<vFV;++vFW){string vED=llGetInventoryName(INVENTORY_NOTECARD,vFW);integer vEE=llSubStringIndex(vED,"{");integer vEF=llSubStringIndex(vED,"}");string vEG="";if(vEE!=-1){vEG=llToLower(llGetSubString(vED,vEE+1,vEF-1));vED=llDeleteSubString(vED,vEE,vEF);}else{vEG="public";}list vFJ=llParseStringKeepNulls(vED,[":"],[]);vAK+=[llList2String(vFJ,-1),vEG];string vEI=llList2String(vFJ,0);if(!vEB&&((vEI==vAL)||(vEI==vAN))){vBR=llGetInventoryName(INVENTORY_NOTECARD,vFW);vEB=TRUE;}if(llListFindList(vAO,[vEI])!=-1){vFJ=llDeleteSubList(vFJ,0,0);while(llGetListLength(vFJ)){string vEJ=llList2String(vFJ,-1);string vEK=llDumpList2String([vBY]+llDeleteSubList(vFJ,-1,-1),":");integer vFT=llListFindList(vAJ,[vEK]);if(vFT!=-1&&!(vFT % 2)){list vEM=llParseStringKeepNulls(llList2String(vAJ,vFT+1),["|"],[]);if(llListFindList(vEM,[vEJ])==-1){vEM+=[vEJ];vAJ=llListReplaceList((vAJ=[])+vAJ,[llDumpList2String(vEM,"|")],vFT+1,vFT+1);}}else{vAJ+=[vEK,vEJ];}vFJ=llDeleteSubList(vFJ,-1,-1);}}}}default{state_entry(){vBS=(string)llGetKey();BuildMenus();}touch_start(integer vEN){vAH=llDetectedKey(0);DoMenu_AccessCtrl(vAH,vBY,"",0);}link_message(integer vEO,integer vEP,string vEQ,key vGC){if(vEP==vAS){integer vFT=llListFindList(vAQ,[vGC]);if(!(~vFT)){return;}list vGD=llParseString2List(vEQ,["|"],[]);integer vEU=(integer)llList2String(vGD,0);string vEV=llList2String(vGD,1);vDW=llList2String(vAQ,vFT+2);vAH=llList2Key(vAQ,vFT+1);if(vEV==vBX){list vFD=llParseString2List(vDW,[":"],[]);vFD=llDeleteSubList(vFD,-1,-1);if(llList2String(vFD,-1)==vBZ){AdminMenu(vAH,llDumpList2String(vFD,":"),"",vCN);}else if(llGetListLength(vFD)<=1){DoMenu(vAH,vBY,"",0);}else{DoMenu(vAH,llDumpList2String(vFD,":"),"",0);}return;}if(vEV==vBZ){vDW+=":"+vEV;AdminMenu(vAH,vDW,"",vCN);return;}if(vEV==vBU){vDW=vDW+":"+vEV;AdminMenu(vAH,vDW,"Where will you sit?",vAP);return;}if(vEV==vBW){vDW=vDW+":"+vEV;AdminMenu(vAH,vDW,"Adjust by "+(string)vBP+"m, or choose another distance.",vBQ);return;}if(vEV==vCB){llMessageLinked(LINK_SET,vAV,"","");AdminMenu(vAH,vDW,"",vCN);return;}if(vEV==vCC){llMessageLinked(LINK_SET,vAY,"","");AdminMenu(vAH,vDW,"",vCN);return;}if(vEV==vCD){llMessageLinked(LINK_SET,vAX,"","");AdminMenu(vAH,vDW,"",vCN);return;}if(vEV==vCE){vAI=vDA();list vFI;integer vFV=llGetListLength(vAI);integer vFW;for(vFW=0;vFW<vFV;vFW++){vFI+=[llGetSubString(llKey2Name((key)llList2String(vAI,vFW)),0,20)];}if(llGetListLength(vFI)>0){vDW+=":"+vEV;AdminMenu(vAH,vDW,"Pick an avatar to unsit",vFI);}else{AdminMenu(vAH,vDW,"",vCN);}return;}if(vEV==vCF){vDW+=":"+vEV;string vFA="Permit currently set to "+llList2String(vAA,0)+"\nMenuOnSit currently set to "+vAB+"\nsit2GetMenu currently set to "+vAE+"\n2default currently set to "+vAC+"\nFacialEnable currently set to "+vAD+"\nUseRLVBaseRestrict currently set to "+vAF;AdminMenu(vAH,vDW,vFA,vCO);return;}if(~llListFindList(vAJ,[vDW+":"+vEV])){vDW=vDW+":"+vEV;DoMenu(vAH,vDW,"",0);return;}if(llList2String(llParseString2List(vDW,[":"],[]),-1)==vBU){if(llGetSubString(vEV,0,3)=="seat"){integer vFC=(integer)llGetSubString(vEV,4,-1);if(vFC>=0){llMessageLinked(LINK_SET,vBD,(string)(vFC),vAH);}}else{integer vFC=llListFindList(vAP,[vEV])+1;if(vFC>=0){llMessageLinked(LINK_SET,vBD,(string)(vFC),vAH);}}list vFD=llParseString2List(vDW,[":"],[]);vFD=llDeleteSubList(vFD,-1,-1);vDW=llDumpList2String(vFD,":");DoMenu(vAH,vDW,"",0);return;}if(llList2String(llParseString2List(vDW,[":"],[]),-1)==vCE){integer vFV=llGetListLength(vAI);integer vFW;for(vFW=0;vFW<vFV;vFW++){key vFG=llList2Key(vAI,vFW);if(llGetSubString(llKey2Name(vFG),0,20)==vEV){if(llListFindList(vDA(),[vFG])!=-1){llMessageLinked(LINK_SET,-222,(string)vFG,NULL_KEY);integer vFH=llListFindList(vAI,[vFG]);vAI=llDeleteSubList(vAI,vFT,vFT);vFW=vFV;}}}list vFI=[];vFV=llGetListLength(vAI);for(vFW=0;vFW<vFV;vFW++){vFI+=[llGetSubString(llKey2Name((key)llList2String(vAI,vFW)),0,20)];}if(llGetListLength(vFI)>0){AdminMenu(vAH,vDW,"Pick an avatar to unsit",vFI);}else{list vFJ=llParseString2List(vDW,[":"],[]);vFJ=llDeleteSubList(vFJ,-1,-1);AdminMenu(vAH,llDumpList2String(vFJ,":"),"",vCN);}return;}if(llList2String(llParseString2List(vDW,[":"],[]),-1)==vBW){vector vFK=<(float)(vEV==vBI),(float)(vEV==vBK),(float)(vEV==vBM)>;vector vFL=<(float)(vEV==vBJ),(float)(vEV==vBL),(float)(vEV==vBN)>;if((llVecMag(vFK)>1.0)||(llVecMag(vFL)>1.0)){llOwnerSay(llDumpList2String(["(",(61440-llGetUsedMemory())>>10,"kB ) ~>","multiple buttons selected:",vFK,vFL,"{","src/menu-vic.lsl",":",585,"}"]," "));}vector vFM=vFK-vFL;if(vFM){vector vFN=vFM*vBP;llMessageLinked(LINK_SET,vBB,(string)vFN,vAH);}else{if(vEV==vBO){llMessageLinked(LINK_SET,vBC,(string)ZERO_VECTOR,vAH);}else{vBP=(float)vEV;}}AdminMenu(vAH,vDW,llDumpList2String(["Adjust by",vBP,"m, or choose another distance."]," "),vBQ);return;}if(vEV==vBV){llMessageLinked(LINK_SET,vAZ,"","");DoMenu(vAH,vDW,"",vEU);return;}list vFO=llDeleteSubList(llParseStringKeepNulls(vDW,[":"],[]),0,0);integer vFP=llListFindList(vAK,[vEV]);string vFQ=llDumpList2String([vAN]+vFO+[vEV],":");string vFR=llDumpList2String([vAL]+vFO+[vEV],":");string vFS=llDumpList2String([vAM]+vFO+[vEV],":");if(vFP!=-1){if(llList2String(vAK,vFP+1)!="public"){vFQ+="{"+llList2String(vAK,vFP+1)+"}";vFR+="{"+llList2String(vAK,vFP+1)+"}";vFS+="{"+llList2String(vAK,vFP+1)+"}";}}if(llGetInventoryType(vFQ)==INVENTORY_NOTECARD){llMessageLinked(LINK_SET,vAU,vFQ,vAH);}else if(llGetInventoryType(vFR)==INVENTORY_NOTECARD){llMessageLinked(LINK_SET,vAU,vFR,vAH);}else if(llGetInventoryType(vFS)==INVENTORY_NOTECARD){llMessageLinked(LINK_SET,vBA,vFS,vAH);}if(llGetSubString(vEV,-1,-1)=="-"){llMessageLinked(LINK_SET,-802,vDW,vAH);}else{DoMenu(vAH,vDW,"",vEU);}return;}if(vEP==vAT){integer vFT=llListFindList(vAQ,[vGC]);if(vFT!=-1){vAQ=llDeleteSubList(vAQ,vFT,vFT+2);}if(vAC=="on"&&llGetListLength(vDA())<1){llMessageLinked(LINK_SET,vAU,vBR,NULL_KEY);}return;}if(vEP==vBH){list vFU=llParseStringKeepNulls(vEQ,["~"],[]);integer vFV=llGetListLength(vFU);integer vFW=0;while(vFW<vFV){list vFX=llParseString2List(llList2String(vFU,vFW),["="],[]);string vFY=llList2String(vFX,0);string vFZ=llList2String(vFX,1);if(vFY=="menuonsit"){vAB=vFZ;jump next_item;}if(vFY=="permit"){vAA=[vFZ];jump next_item;}if(vFY=="2default"){vAC=vFZ;jump next_item;}if(vFY=="sit2getmenu"){vAE=vFZ;jump next_item;}if(vFY=="vicgetsmenu"){vAG=vFZ;jump next_item;}if(vFY=="facialExp"){vAD=vFZ;llMessageLinked(LINK_SET,-241,vAD,NULL_KEY);jump next_item;}if(vFY=="rlvbaser"){vAF=vFZ;llMessageLinked(LINK_SET,-1812221819,"RLV="+vAF,NULL_KEY);jump next_item;}@next_item;++vFW;}return;}if(vEP==-888&&vEQ==vBZ){vDW+=":"+vEQ;AdminMenu(vAH,vDW,"",vCN);return;}if(vEP==-888&&vEQ==vBU){vDW=vDW+":"+vEQ;AdminMenu(vAH,vDW,"Where will you sit?",vAP);return;}if(vEP==-888&&vEQ==vBW){vDW=vDW+":"+vEQ;AdminMenu(vAH,vDW,"Adjust by "+(string)vBP+"m, or choose another distance.",vBQ);return;}if(vEP==-888&&vEQ==vBV){llMessageLinked(LINK_SET,vAZ,"","");DoMenu(vAH,vDW,"",0);return;}if(vEP==vBE){vAH=vGC;DoMenu(vAH,vEQ,"",0);return;}if(vEP==vBF){vAH=vGC;DoMenu_AccessCtrl(vAH,vBY,"",0);return;}if(vEP==-238){vCM=llCSV2List(vEQ);return;}if(vEP==35354){vAP=llParseString2List(vEQ,[","],[]);return;}if(vEP==vBG){llSay(0,"Memory Used by "+llGetScriptName()+": "+(string)llGetUsedMemory()+" of "+(string)llGetMemoryLimit()+",Leaving "+(string)llGetFreeMemory()+" memory free.");}}changed(integer vGA){if(vGA&CHANGED_INVENTORY){BuildMenus();}if(vGA&CHANGED_OWNER){llResetScript();}vAI=vDA();if((vGA&CHANGED_LINK)&&(vDC()>0)){if(vAB=="on"){integer vGB=llGetListLength(vAI);if(vGB>vBT){key vGC=llList2Key(vAI,vGB-vBT-1);vBT=vGB;if(llListFindList(vCM,[vGC])==-1){DoMenu_AccessCtrl(vGC,vBY,"",0);}}}vBT=llGetListLength(vAI);}else if((vGA&CHANGED_LINK)&&(vAC=="on")){llMessageLinked(LINK_SET,vAU,vBR,NULL_KEY);vBT=0;}}on_rez(integer vGD){llResetScript();}}
